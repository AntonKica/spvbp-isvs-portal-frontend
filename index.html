<!DOCTYPE html>
<html lang="sk">
  <head>
    <meta charset="UTF-8">
    <title>Iniciácia ISMS</title>
    <script src="https://unpkg.com/htmx.org@1.9.9" integrity="sha384-QFjmbokDn2DjBjq+fM+8LUIVrAgqcNW2s0PjAxHETgRn9l4fvX31ZxDxvwQnyMOX" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
    <script src="common.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

  </head>

  <body>
    <!DOCTYPE html>
    <html lang="sk">
      <head>
        <meta charset="UTF-8">
      </head>
      <body>
        <div class="row justify-content-md-center">
          <div class="col-10">
            <h1 class="display-1">Iniciácia ISMS</h1>
            <div class="row">
              <h4> <span class="text-primary"> Prečítaj si viac <span> </h4>
              <div class="col-4">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">manuál</th>
                      <th scope="col">kapitola</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>IT-Grundschutz-Compendium</td>
                      <td>ISMS.1 Security Management</td>
                    </tr>
                    <tr>
                      <td> BSI-Standard 200-2 IT-Grundschutz Methodology </td>
                      <td> 3.1 Accepting responsibility by management </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <h2>  Prvé kroky </h2>
            <div class="alert alert-warning" role="alert">
              <h2> ! Bez podpory manažmentu to nejde ! </h2>
              Bezpečnostný proces nemôže spustiť nikto iný ako CEO/vedenie.
              Je nutné aby vrchný manažment prevzal zodpovednosť za informačnú bezpečnosť.
            </div>

            <div id="showISO">
              <h3 class="alert alert-success" role="alert"> ISO je: <span id="humanISO"></span> </h3>
            </div>
            <div id="createISO"3
              <h3 class="alert alert-danger" role="alert"> Rola ISO nie je obsadená </h3>
            </div>
            <h4> Priraď rolu ISO </h4>
            <form id="bindISO">
              <div class="row">
                <div class="col-3"> <select class="form-select" name="humanId" id="humanOptions"> </select></div>
                  <div class="col"><input type="submit" class="btn btn-primary" value="Nastav rolu ISO" onclick="bindISO(event)"></div>
              </div>
            </form>
            <hr>
            <h4> Vytvor nového človeka </h4>
            <form hx-post="/svc/human" hx-ext="json-enc" hx-swap="none">
              <div class="row">
                <div class="col-4">
                  <label for="firstName" class="form-label">Meno</label>
                  <input type="text" class="form-control id="firstName" name="firstName"><br>
                </div>
                <div class="col-4">
                  <label for="lastName">Priezvisko</label>
                  <input type="text" class="form-control id="lastName" class="form-label" name="lastName"><br><br>
                </div>
              </div>
              <input type="submit" class="btn btn-primary" value="Vytvor človeka">
            </form>
          </div>
          <script>
            fetch('/svc/human/list')
              .then(response => response.json())
              .then(humans => humans.map(human => `<option value="${human.id}">${human.firstName} ${human.lastName} </option>`))
              .then(options => document.getElementById("humanOptions").innerHTML = options)

            // TODO HARDCODED VALUE 1
            fetch('/svc/role/1')
              .then(response => response.json()) 
              .then(data => {
                if(data.humans.length === 0) {
                  document.getElementById("showISO").setAttribute("hidden", "")
                } else {
                  document.getElementById("createISO").setAttribute("hidden", "")
                  const iso = data.humans[0]
                  document.getElementById("humanISO").textContent = `${iso.firstName} ${iso.lastName}`
                }
              })
            async function bindISO(event) {
              event.preventDefault()

              const bindRoleForm = document.getElementById('bindISO')
              const formData = new FormData(bindRoleForm)
              const humanId = formData.get("humanId")

              // TODO HARDCODED VALUE 1
              // clear bound roles
              await fetch(`/svc/role/1/clear`, { method: "POST"})
              const res = await fetch(`/svc/human/${humanId}/bind/role/1`, { method: "POST"})
              const text = await res.text()
              alert(text)
              if(res.ok) {
                window.location.reload()
              }
            }
          </script>
        </div>
        </div>
      </body>
    </html>

